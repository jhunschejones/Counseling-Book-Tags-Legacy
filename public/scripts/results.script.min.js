var searchedTags=[],bookData;function truncate(str,len){var subString=str.substr(0,len-1);return subString.substr(0,subString.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}function getAllBooks(handleData){$("#results-for-this-letter").html(""),$.ajax({method:"GET",url:"/api/v1/book/tags/"+searchedTags,success:function(data){handleData(data)},error:function(error){handleData()}})}function poulatePage(){let displayTag;displayTag=searchedTags[0]&&searchedTags[0].length>40?truncate(searchedTags[0],40):searchedTags[0],$("#selected-tags").html(""),$("#selected-tags").append(`<a class="static-tag badge badge-pill" value="${searchedTags[0]}">${displayTag}</a>`);for(let index=1;index<searchedTags.length;index++){const tag=searchedTags[index];let shortTag;shortTag=tag&&tag.length>40?truncate(tag,40):tag,$("#selected-tags").append(`<a class="badge selected-tag badge-pill badge-light" value="${tag}">${shortTag}<span class="delete-button" data-tag="${tag}">&#10005;</span></a>`)}$("#matching-books").html(""),bookData.forEach(book=>{let author=book.author[0],title=book.title,bookID=book._id,tagPile="";book.tags.forEach(tag=>{let shortTag;shortTag=tag&&tag.length>40?truncate(tag,40):tag,tagPile+=`<button class="tag badge badge-pill" value="${tag}" style="display:inline;">${shortTag}</button>`}),$("#matching-books").append(`<hr/><div class="row"><div class="col"><a href="/details?id=${bookID}" class="book-info" style="display:inline;">${title} - ${author}</a></div><div class="col">${tagPile}</div></div>`)}),$(".tag").on("click",function(){let clickedTag=$(this).attr("value");-1==searchedTags.indexOf(clickedTag)?window.location.href=window.location.href.replace(/\#/g,"")+","+clickedTag.replace(/,/g,"%2C"):alert(`You already selected the "${clickedTag}" tag!`)}),$(".delete-button").on("click",function(){let clickedTag=$(this).attr("data-tag"),index=searchedTags.indexOf(clickedTag);searchedTags=searchedTags.splice(0,index);for(let index=0;index<searchedTags.length;index++)searchedTags[index]=searchedTags[index].replace(/,/g,"%2C");searchedTags.join(","),window.location.href="/results?tags="+searchedTags})}new URL(document.location).searchParams.get("tags").replace(/\%20/g," ").replace(/\%27/g,"'").split(",").forEach(element=>{searchedTags.push(element.replace(/\%2C/g,","))}),getAllBooks(function(output){(bookData=output||[])&&0!==bookData.length?poulatePage():($("#selected-tags").html(""),$("#selected-tags").append('<br/><p class="warning-text">Oops, looks like you didn\'t select any tags to search by. Head back <a href="/">home</a> to try again!</p>'))});