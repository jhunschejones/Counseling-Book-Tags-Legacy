let allBooks,tagElements;function getAllBooks(handleData){$("#results-for-this-letter").html(""),$.ajax({method:"GET",url:"/api/v1/book",success:function(data){handleData(data)}})}function populateTags(){let allTags=[];allBooks.forEach(book=>{book.tags.forEach(tag=>{-1==allTags.indexOf(tag)&&allTags.push(tag)})}),allTags.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}),allTags.forEach(tag=>{let letter=tag.charAt(0).toLowerCase(),displayTag;displayTag=tag.length>40?truncate(tag,40):tag,$(`#${letter}-results`).append(`<button class="tag badge badge-pill" value="${tag}">${displayTag}</button>`),$(`#${letter}-results`).show(),$(`#all-${letter}-results`).append(`<button class="tag badge badge-pill" value="${tag}">${displayTag}</button>`),$(`#all-${letter}-results`).show()}),alphabetFilter(),$(".tag").on("click",function(){window.location.href="/results?tags="+$(this).attr("value").replace(/,/g,"%2C")})}function searchFilter(){if(userInput=document.getElementById("user-search-input").value.toUpperCase(),0==userInput.trim().length)for(let i=0;i<tagElements.length;i++)tagElements[i].style.display="";else for(let i=0;i<tagElements.length;i++)-1!=tagElements[i].value.toUpperCase().indexOf(userInput)?tagElements[i].style.display="":tagElements[i].style.display="none"}function alphabetFilter(evt){$("#all-columns").hide(),$("#alphabet-columns").show();let searchInput=document.getElementById("user-search-input"),letters;searchInput.value.trim()&&(searchInput.value="",searchFilter());let defaultLetters=sessionStorage.getItem("alphabetSelection")||["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];evt?(letters=evt.target.letters,sessionStorage.setItem("alphabetSelection",letters),toggleSelectedFilter(evt),setPageContentLabel(letters)):(letters=defaultLetters,sessionStorage.setItem("alphabetSelection",letters),letters.length>5?(allFilter(),setPageContentLabel(letters)):(toggleSelectedFilter(),setPageContentLabel(letters)));let alphabetResults=document.getElementsByClassName("alphabet-results");for(let index=0;index<alphabetResults.length;index++){const element=alphabetResults[index];element.style.display="none";for(let index=0;index<letters.length;index++){const letter=letters[index];element.id.charAt(0)==letter&&(element.style.display="")}}}function allFilter(evt){$("#all-columns").show(),$("#alphabet-columns").hide();let searchInput=document.getElementById("user-search-input");if(searchInput.value.trim()&&(searchInput.value="",searchFilter()),evt){let letters=evt.target.letters;sessionStorage.setItem("alphabetSelection",letters),toggleSelectedFilter(evt),setPageContentLabel(letters)}else{toggleSelectedFilter();let letters=sessionStorage.getItem("alphabetSelection")||["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];setPageContentLabel()}}function toggleSelectedFilter(evt){if(evt){let selected=document.getElementsByClassName("selected-filter");if(selected)for(let index=0;index<selected.length;index++){const element=selected[index];element.classList.remove("selected-filter")}evt.target.classList.add("selected-filter")}else{let defaultLetters=sessionStorage.getItem("alphabetSelection")||["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];defaultLetters.length<5?document.getElementById(`books-${defaultLetters[0]}-${defaultLetters[2]}-nav`).classList.add("selected-filter"):document.getElementById("books-all-nav").classList.add("selected-filter")}}function setPageContentLabel(input){let letters=input||sessionStorage.getItem("alphabetSelection")||["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];if(letters.length<5){let firstLetter=letters[0].toUpperCase(),secondLetter=letters[1].toUpperCase();"-"!=secondLetter&&","!=secondLetter||(secondLetter=letters[2].toUpperCase()),$("#page-content-label").text(`Book Tags: ${firstLetter} - ${secondLetter}`),document.getElementById("user-search-input").placeholder=`Filter tags ${firstLetter.toLowerCase()} - ${secondLetter.toLowerCase()}...`}else $("#page-content-label").text("Book Tags: All"),document.getElementById("user-search-input").placeholder="Filter all tags..."}function truncate(str,len){let subString=str.substr(0,len-1);return subString.substr(0,subString.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}getAllBooks(function(output){allBooks=output,populateTags(),tagElements=document.getElementsByClassName("tag")}),document.getElementById("user-search-input").addEventListener("input",searchFilter);let alltags_nav=document.getElementById("books-all-nav");alltags_nav.addEventListener("click",allFilter),alltags_nav.letters=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];let ab_nav=document.getElementById("books-a-b-nav");ab_nav.addEventListener("click",alphabetFilter),ab_nav.letters=["a","b"];let cd_nav=document.getElementById("books-c-d-nav");cd_nav.addEventListener("click",alphabetFilter),cd_nav.letters=["c","d"];let ef_nav=document.getElementById("books-e-f-nav");ef_nav.addEventListener("click",alphabetFilter),ef_nav.letters=["e","f"];let gh_nav=document.getElementById("books-g-h-nav");gh_nav.addEventListener("click",alphabetFilter),gh_nav.letters=["g","h"];let ij_nav=document.getElementById("books-i-j-nav");ij_nav.addEventListener("click",alphabetFilter),ij_nav.letters=["i","j"];let kl_nav=document.getElementById("books-k-l-nav");kl_nav.addEventListener("click",alphabetFilter),kl_nav.letters=["k","l"];let mn_nav=document.getElementById("books-m-n-nav");mn_nav.addEventListener("click",alphabetFilter),mn_nav.letters=["m","n"];let op_nav=document.getElementById("books-o-p-nav");op_nav.addEventListener("click",alphabetFilter),op_nav.letters=["o","p"];let qr_nav=document.getElementById("books-q-r-nav");qr_nav.addEventListener("click",alphabetFilter),qr_nav.letters=["q","r"];let st_nav=document.getElementById("books-s-t-nav");st_nav.addEventListener("click",alphabetFilter),st_nav.letters=["s","t"];let uv_nav=document.getElementById("books-u-v-nav");uv_nav.addEventListener("click",alphabetFilter),uv_nav.letters=["u","v"];let wx_nav=document.getElementById("books-w-x-nav");wx_nav.addEventListener("click",alphabetFilter),wx_nav.letters=["w","x"];let yz_nav=document.getElementById("books-y-z-nav");yz_nav.addEventListener("click",alphabetFilter),yz_nav.letters=["y","z"];