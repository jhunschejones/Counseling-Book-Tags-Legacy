function bookSearch(searchValue,searchParam){let newBooks,databaseBooks;$("#database-books-spinner").show(),$("#new-books-spinner").show(),$("#new-book-results").html(""),$("#database-book-results").html("");let multiPage=!1;$.when($.ajax({method:"GET",url:`/api/v1/search/${searchParam}/${searchValue}`,success:function(data){newBooks=data}}),$.ajax({method:"GET",url:`/api/v1/book/${searchParam}/${searchValue}`,success:function(data){databaseBooks=data}})).then(function(){if(newBooks[0]&&newBooks[0].totalPages&&newBooks[0].totalPages>1&&(multiPage=!0),databaseBooks&&databaseBooks.length>0&&!databaseBooks.message)for(let index=0;index<newBooks.length;index++){const newBook=newBooks[index];for(let index=0;index<databaseBooks.length;index++){const databaseBook=databaseBooks[index];databaseBook.goodreadsBookID===newBook.goodreadsBookID&&newBooks.splice(index,1)}}databaseBooks.message?$("#database-books-spinner").hide():populateDatabaseBooks(databaseBooks),multiPage?$.ajax({method:"GET",url:`/api/v1/search/${searchParam}/${searchValue}?page=2`,success:function(data){newBooks=newBooks.concat(data)}}).then(function(){if(databaseBooks&&databaseBooks.length>0&&!databaseBooks.message){newBooks.splice(0,1);for(let index=0;index<newBooks.length;index++){const newBook=newBooks[index];for(let index=0;index<databaseBooks.length;index++){const databaseBook=databaseBooks[index];databaseBook.goodreadsBookID===newBook.goodreadsBookID&&newBooks.splice(index,1)}}}for(let index=0;index<newBooks.length;index++){const book=newBooks[index];book.goodreadsBookID?$.ajax({method:"GET",url:`/api/v1/search/details/${book.goodreadsBookID}`,success:function(fullData){fullData.isbn||newBooks.splice(index,1)},error:function(){newBooks.splice(index,1)}}):newBooks.splice(index,1)}populateNewBooks(newBooks)}):populateNewBooks(newBooks)}).fail(function(){$("#database-book-results").html('<p class="text-center">There were no results matching this search. Please try a different search.</p>')})}function addNewBook(goodreadsBookID){window.location.href="/details?id="+goodreadsBookID}function populateDatabaseBooks(bookData){$("#database-books-header").show(),$("#database-books-sub-header").show(),bookData&&bookData.forEach(book=>{$("#database-book-results").append(`<span class="database-book" data-id="${book._id}" data-toggle="tooltip" data-placement="right" data-html="true" title="<img src='${book.cover}' style='height:175px;'>">${book.title} - ${book.author[0]} (${book.published})</span><br/>`)}),$("#database-books-spinner").hide(),$(".database-book").on("click",function(){window.location.href="/details?id="+$(this).attr("data-id")})}function populateNewBooks(bookData){if($("#new-books-header").show(),$("#new-books-sub-header").show(),bookData[0]&&bookData[0].totalPages){const pageInfo=bookData[0];for(let index=1;index<bookData.length;index++){const book=bookData[index];"undefined"!=book.goodreadsBookID&&$("#new-book-results").append(`<span class="new-book" data-goodreadsBookID="${book.goodreadsBookID}" data-title="${book.title}" data-toggle="tooltip" data-placement="right" data-html="true" title="<img src='${book.cover}' style='height:175px;'>">${book.title} - ${book.author} (${book.published})&nbsp;&nbsp;<strong class="add-tag-button text-secondary">&#43;</strong></span><br/>`)}}else bookData.forEach(book=>{$("#new-book-results").append(`<span class="new-book" data-goodreadsBookID="${book.goodreadsBookID}" data-title="${book.title}" data-toggle="tooltip" data-placement="right" data-html="true" title="<img src='${book.cover}' style='height:175px;'>">${book.title} - ${book.author} (${book.published})&nbsp;&nbsp;<strong class="add-tag-button text-secondary">&#43;</strong></span></br>`)});$("#new-books-spinner").hide();let isTouchDevice=!1;"ontouchstart"in document.documentElement&&(isTouchDevice=!0),!1===isTouchDevice&&$('[data-toggle="tooltip"]').tooltip(),$(".new-book").on("click",function(){let goodreadsBookID=$(this).attr("data-goodreadsBookID"),titleKeyWords=$(this).attr("data-title"),similarBookTitles;$.ajax({method:"GET",url:"/api/v1/book/title/"+titleKeyWords,success:function(data){similarBookTitles=data}}).then(function(){if(similarBookTitles.length>0){$("#add-new-book-modal-body").html(""),$("#add-new-book-modal").modal("toggle");let booksList='<ul id="alternate-book-list">';similarBookTitles.forEach(book=>{booksList+=`<li class="alternate-book text-primary" data-bookID="${book._id}">${book.title}</li>`}),booksList+="</ul>",1==similarBookTitles.length?$("#add-new-book-tile").text("Did you mean this book instead?"):$("#add-new-book-tile").text("Did you mean one of these books instead?"),$("#add-new-book-modal-body").append(booksList),$(".alternate-book").on("click",function(){window.location.href="/details?id="+$(this).attr("data-bookID")}),document.getElementById("add-new-book-button").addEventListener("click",function(){addNewBook(goodreadsBookID)})}else addNewBook(goodreadsBookID)})})}document.getElementById("search-button").addEventListener("click",function(){const searchType=$("#search-type").val(),searchValue=$("#search-input").val().trim();$("#database-books-header").hide(),$("#new-books-header").hide(),$("#new-books-sub-header").hide(),$("#database-books-sub-header").hide(),"isbn"===searchType?bookSearch(searchValue,"isbn"):"author"===searchType?bookSearch(searchValue,"author"):"title"===searchType&&bookSearch(searchValue,"title")});let searchInput=document.getElementById("search-input");searchInput.addEventListener("keyup",function(event){event.preventDefault(),13===event.keyCode&&document.getElementById("search-button").click()});